<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üéµ Music Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .rotate-cover {
        animation: spin 12s linear infinite;
      }
      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body class="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-black flex items-center justify-center relative px-4 sm:px-6">

    <!-- Home Button -->
    <a href="{% url 'home' %}" class="absolute top-4 left-4">
      <button class="bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-md shadow-md transition">
        ‚Üê Home
      </button>
    </a>

    <main class="w-full max-w-md bg-white/10 backdrop-blur-lg border border-white/20 p-6 rounded-2xl shadow-lg text-white space-y-6 relative overflow-hidden">
      <h2 class="text-3xl font-bold text-center mb-4 animate-pulse">üé∂ Music Player</h2>

      <!-- Album Cover -->
      <div class="w-full flex justify-center">
        <img id="cover" src="" alt="cover" class="w-40 h-40 rounded-full object-cover shadow-lg border-4 border-white/30 transition-transform duration-700">
      </div>

      <!-- Song Title -->
      <div class="text-center text-xl font-semibold tracking-wide" id="title">Loading...</div>

      <!-- Playlist Dropdown -->
      <div class="relative">
        <select id="playlist" class="w-full bg-white/20 backdrop-blur-sm text-white px-3 py-2 rounded-md focus:outline-none shadow-inner">
          <!-- JS Populated -->
        </select>
      </div>

      <!-- Audio Element -->
      <audio id="audio" preload="metadata"></audio>

      <!-- Controls -->
      <div class="flex justify-center items-center space-x-6 text-2xl">
        <button id="prev" class="hover:text-pink-400 transition" title="Previous"><i class="fa fa-backward"></i></button>
        <button id="playPause" class="hover:text-green-400 transition" title="Play/Pause"><i class="fa fa-play"></i></button>
        <button id="next" class="hover:text-pink-400 transition" title="Next"><i class="fa fa-forward"></i></button>
      </div>

      <!-- Progress Bar -->
      <input type="range" id="progress" value="0" min="0" max="100" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer accent-pink-500">

      <!-- Time and Volume -->
      <div class="flex justify-between items-center text-sm text-gray-300">
        <span id="currentTime">0:00</span>
        <span id="duration">0:00</span>
        <div class="flex items-center space-x-1">
          <i class="fa fa-volume-down"></i>
          <input type="range" id="volume" min="0" max="1" step="0.01" class="w-16 accent-green-400">
        </div>
      </div>

      <!-- Download -->
      <div class="flex justify-center">
        <a id="downloadBtn" href="#" download class="text-sm text-pink-300 underline hover:text-pink-500 transition">Download Song</a>
      </div>
    </main>

    <script>
      const audio = document.getElementById('audio');
      const playPause = document.getElementById('playPause');
      const progress = document.getElementById('progress');
      const currentTimeEl = document.getElementById('currentTime');
      const durationEl = document.getElementById('duration');
      const title = document.getElementById('title');
      const prev = document.getElementById('prev');
      const next = document.getElementById('next');
      const cover = document.getElementById('cover');
      const volume = document.getElementById('volume');
      const playlist = document.getElementById('playlist');
      const downloadBtn = document.getElementById('downloadBtn');

      let isPlaying = false;
      let currentSong = 0;
      let songs = [];

      async function fetchSongs() {
        songs = [
          {
            name: 'Acoustic Breeze',
            url: 'https://www.bensound.com/bensound-music/bensound-acousticbreeze.mp3',
            cover: 'https://www.bensound.com/bensound-img/acousticbreeze.jpg'
          },
          {
            name: 'Better Days',
            url: 'https://www.bensound.com/bensound-music/bensound-betterdays.mp3',
            cover: 'https://www.bensound.com/bensound-img/betterdays.jpg'
          },
          {
            name: 'Sunny',
            url: 'https://www.bensound.com/bensound-music/bensound-sunny.mp3',
            cover: 'https://www.bensound.com/bensound-img/sunny.jpg'
          }
        ];
        populatePlaylist();
        loadSong(currentSong);
      }

      function populatePlaylist() {
        songs.forEach((song, i) => {
          const option = document.createElement('option');
          option.value = i;
          option.textContent = song.name;
          playlist.appendChild(option);
        });
      }

      function loadSong(index) {
        const song = songs[index];
        audio.src = song.url;
        title.textContent = song.name;
        cover.src = song.cover;
        document.title = `üéµ ${song.name}`;
        playlist.value = index;
        downloadBtn.href = song.url;
      }

      function togglePlayPause() {
        if (isPlaying) {
          audio.pause();
          playPause.innerHTML = '<i class="fa fa-play"></i>';
          cover.classList.remove('rotate-cover');
        } else {
          audio.play();
          playPause.innerHTML = '<i class="fa fa-pause"></i>';
          cover.classList.add('rotate-cover');
        }
        isPlaying = !isPlaying;
      }

      playPause.addEventListener('click', togglePlayPause);

      audio.addEventListener('timeupdate', () => {
        const progressPercent = (audio.currentTime / audio.duration) * 100;
        progress.value = progressPercent || 0;
        updateTime();
      });

      progress.addEventListener('input', () => {
        audio.currentTime = (progress.value / 100) * audio.duration;
      });

      function updateTime() {
        const format = (sec) => isNaN(sec) ? '0:00' : `${Math.floor(sec / 60)}:${('0' + Math.floor(sec % 60)).slice(-2)}`;
        currentTimeEl.textContent = format(audio.currentTime);
        durationEl.textContent = format(audio.duration);
      }

      next.addEventListener('click', () => {
        currentSong = (currentSong + 1) % songs.length;
        loadSong(currentSong);
        if (isPlaying) audio.play();
      });

      prev.addEventListener('click', () => {
        currentSong = (currentSong - 1 + songs.length) % songs.length;
        loadSong(currentSong);
        if (isPlaying) audio.play();
      });

      audio.addEventListener('ended', () => next.click());

      volume.addEventListener('input', () => {
        audio.volume = volume.value;
      });

      playlist.addEventListener('change', (e) => {
        currentSong = parseInt(e.target.value);
        loadSong(currentSong);
        if (isPlaying) audio.play();
      });

      window.onload = fetchSongs;
    </script>
  </body>
</html>
