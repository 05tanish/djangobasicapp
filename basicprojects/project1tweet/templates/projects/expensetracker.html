<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>💰 Expense Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="relative bg-gray-100 text-gray-900 dark:bg-gray-900 dark:text-white min-h-screen flex items-center justify-center px-4">

  <!-- Home Button -->
  <a href="{% url 'home' %}" class="absolute top-4 left-4 z-50">
    <button class="bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded shadow">
      ← Home
    </button>
  </a>

  <div class="bg-white dark:bg-gray-800 shadow-xl rounded-xl p-8 w-full max-w-md space-y-6">
    <!-- ... rest of password generator content ... -->

<body class="bg-gray-100 text-gray-900 dark:bg-gray-900 dark:text-white transition-colors duration-300">

  <!-- Top Bar -->
  <div class="p-4 flex justify-between items-center bg-white dark:bg-gray-800 shadow-md">
    <h1 class="text-2xl font-bold">💰 Expense Tracker</h1>
    <button id="darkToggle" class="text-sm px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition">
      Toggle Dark Mode
    </button>
  </div>

  <!-- Main Container -->
  <div class="max-w-4xl mx-auto px-4 py-8 space-y-6">

    <!-- Form -->
    <form id="expenseForm" class="bg-white dark:bg-gray-800 shadow rounded p-6 space-y-4" enctype="multipart/form-data">
      <div>
        <label class="block font-semibold mb-1" for="fieldinput">Field of Expense</label>
        <input type="text" id="fieldinput" required class="w-full rounded p-2 bg-gray-100 dark:bg-gray-700"/>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold mb-1" for="expense">Amount</label>
          <input type="number" id="expense" required class="w-full rounded p-2 bg-gray-100 dark:bg-gray-700"/>
        </div>
        <div>
          <label class="block font-semibold mb-1" for="date">Date</label>
          <input type="date" id="date" required class="w-full rounded p-2 bg-gray-100 dark:bg-gray-700"/>
        </div>
        <div>
          <label class="block font-semibold mb-1" for="time">Time</label>
          <input type="time" id="time" required class="w-full rounded p-2 bg-gray-100 dark:bg-gray-700"/>
        </div>
        <div>
          <label class="block font-semibold mb-1" for="status">Status</label>
          <select id="status" class="w-full rounded p-2 bg-gray-100 dark:bg-gray-700">
            <option value="done">✅ Done</option>
            <option value="inprogress">⏳ In Progress</option>
            <option value="pending">❌ Pending</option>
          </select>
        </div>
      </div>

      <div>
        <label class="block font-semibold mb-1" for="img">Upload Receipt</label>
        <input type="file" id="img" accept="image/*" class="w-full bg-gray-100 dark:bg-gray-700 p-2 rounded"/>
      </div>

      <div>
        <label class="block font-semibold mb-1" for="notes">Notes</label>
        <textarea id="notes" rows="2" class="w-full rounded p-2 bg-gray-100 dark:bg-gray-700"></textarea>
      </div>

      <button type="submit" class="mt-4 w-full bg-pink-600 hover:bg-pink-700 text-white font-semibold py-2 rounded">Add Expense</button>
    </form>

    <!-- Image Preview Modal -->
    <div id="imgPreview" class="fixed inset-0 bg-black/70 flex items-center justify-center hidden z-50">
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg relative max-w-sm">
        <button id="closeImgPreview" class="absolute top-2 right-2 text-xl font-bold text-red-500">×</button>
        <img id="previewImgTag" src="" alt="Receipt Preview" class="w-full rounded" />
      </div>
    </div>

    <!-- Expense List & Chart -->
    <div class="bg-white dark:bg-gray-800 shadow rounded p-6">
      <h2 class="text-xl font-bold mb-4">📋 Your Expenses</h2>
      <div id="expenseList" class="space-y-3 max-h-64 overflow-y-auto pr-2"></div>
      <h3 class="text-lg font-semibold mt-6 mb-2">📊 Expense Chart</h3>
      <canvas id="expenseChart" height="200"></canvas>
    </div>

  </div>

  <!-- ✅ Correct JavaScript Block -->
  <script>
    const form = document.getElementById("expenseForm");
    const expenseList = document.getElementById("expenseList");
    const imgInput = document.getElementById("img");
    const preview = document.getElementById("imgPreview");
    const previewImgTag = document.getElementById("previewImgTag");
    const closeImgPreview = document.getElementById("closeImgPreview");
    const darkToggle = document.getElementById("darkToggle");

    let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
    let chart;
    const chartCanvas = document.getElementById("expenseChart");

    function renderExpenses() {
      expenseList.innerHTML = "";
      const totals = {};

      expenses.forEach((exp, index) => {
        const div = document.createElement("div");
        div.className = "p-3 rounded-lg bg-gray-100 dark:bg-gray-700 shadow flex justify-between items-start";

        const tagColor = exp.status === "done" ? "green" : exp.status === "inprogress" ? "yellow" : "red";

        div.innerHTML = `
          <div>
            <p class="font-bold">${exp.field} - ₹${exp.amount}</p>
            <p class="text-sm text-gray-600 dark:text-gray-300">${exp.date} ${exp.time}</p>
            <p class="text-sm italic">${exp.notes || "No notes"}</p>
            <p class="text-xs mt-1"><span class="px-2 py-1 rounded bg-${tagColor}-200 text-${tagColor}-900">${exp.status}</span></p>
            ${exp.img ? `<button onclick="showImage('${exp.img}')" class="mt-2 text-sm text-blue-600 underline">View Receipt</button>` : ""}
          </div>
          <button onclick="deleteExpense(${index})" class="text-red-600 hover:text-red-800">🗑️</button>
        `;

        expenseList.appendChild(div);
        totals[exp.field] = (totals[exp.field] || 0) + parseFloat(exp.amount);
      });

      updateChart(totals);
      localStorage.setItem("expenses", JSON.stringify(expenses));
    }

    function updateChart(data) {
      const labels = Object.keys(data);
      const values = Object.values(data);

      if (chart) chart.destroy();
      chart = new Chart(chartCanvas, {
        type: "doughnut",
        data: {
          labels,
          datasets: [{
            data: values,
            backgroundColor: ["#f472b6", "#60a5fa", "#facc15", "#4ade80", "#f87171", "#a78bfa"]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const newExp = {
        field: form.fieldinput.value,
        amount: form.expense.value,
        date: form.date.value,
        time: form.time.value,
        img: "",
        notes: form.notes.value,
        status: form.status.value
      };

      if (imgInput.files[0]) {
        const reader = new FileReader();
        reader.onload = () => {
          newExp.img = reader.result;
          expenses.push(newExp);
          renderExpenses();
          form.reset();
        };
        reader.readAsDataURL(imgInput.files[0]);
      } else {
        expenses.push(newExp);
        renderExpenses();
        form.reset();
      }
    });

    function deleteExpense(index) {
      if (confirm("Delete this expense?")) {
        expenses.splice(index, 1);
        renderExpenses();
      }
    }

    function showImage(src) {
      previewImgTag.src = src;
      preview.classList.remove("hidden");
    }

    closeImgPreview.addEventListener("click", () => {
      preview.classList.add("hidden");
    });

    darkToggle.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
    });

    renderExpenses();
  </script>
</body>
</html>
